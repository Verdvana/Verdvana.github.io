---
layout: post
title:  "Tcl语法与实例"
date:   2022-12-08 20:27:10 +0700
tags:
  - Tcl
---

-------


## 1 前言

&#160; &#160; &#160; &#160; 搞IC的哪能不会Tcl，虽然我也是才学😅。


----

## 2 Tcl基础

### 2.1 简介

&#160; &#160; &#160; &#160; Tcl全称Tool command language，是一种解释性语言，不像其他高级语言需要编译，而像shell语言一样，直接对每条语言顺次解释执行。对它而言，要处理的数据只有一种——字符串，它将变量值以字符串的形式进行存储，不关心它的实际使用类型。

&#160; &#160; &#160; &#160; Tcl的执行是交互式的，Tcl提供了交互式命令界面：tclsh和wish。tclsh只支持Tcl命令，wish支持Tcl和Tk命令。通过交互界面，我们就可以像执行shell命令一样，逐条命令执行，并即时得到执行结果。

### 2.2 命令格式

&#160; &#160; &#160; &#160; 一条Tcl基本语法为：

```tcl
#命令 参数1 参数2 ...
command arg1 arg2 ... 
```

&#160; &#160; &#160; &#160; 其中command为Tcl内建命令或者Tcl过程，各条命令可以单独一行，**也可以在同一行，在同一行时，要用“;”来分割：**

```tcl
command1 arg1; command2 arg2; #comment
```


&#160; &#160; &#160; &#160; 字符串中如果有空格，要用“”或者{}括起来，因为Tcl语句中各命令参数是以空格来分割的，否则，字符串中的单词会被认为多余的参数而出错。

### 2.3 可执行脚本文件

&#160; &#160; &#160; &#160; 编写完一个脚本文件吼，可用source来执行该脚本，但需要先启动tclsh。要编写可执行脚本文件，需要在脚本中加入指定解释器，类似其他脚本比如Perl：
```tcl
#!/usr/bin/tclsh
```


----

## 3 输出、复制与替换

### 3.1 puts

&#160; &#160; &#160; &#160; Tcl的输出命令是“puts”，将字符串输出到标准输出channelld：

```tcl
puts hello;                   # 字符串不需要引号
puts "hello world";           # 有空格需要加引号或花括号
puts -nonewline "hello world";# 此选项不输出回车换行
```

&#160; &#160; &#160; &#160; 需要注意的是，**双引号和花括号是有差别的，在处理“替换操作时”，前者允许替换发生，后者可能会阻止替换。**

### 3.2 set&unset

&#160; &#160; &#160; &#160; set为变量定义和赋值命令，不需要指定变量值的类型，因为**变量值的类型只有一种：字符串。**

&#160; &#160; &#160; &#160; unset命令与set命令作用相反，它取消变量定义，并释放变量所占的内存空间。

&#160; &#160; &#160; &#160; 通过“$”符，可以引用变量的值。

&#160; &#160; &#160; &#160; set命令也可以只跟变量而无变量值，若变量已经定义，则返回变量值，效果和puts类似。如果变量不存在，则返回错误信息。

```tcl
set   a hello;                # 定义变量a并赋值字符串
set   a "hello world";        # 重新赋值
set   a;                      # 输出变量a值，此时不加“$”
puts  $a;                     # 输出变量a值，此时要加“$”
set   b $a;                   # 将变量a的值赋给b
unset a;                      # 释放变量a
puts  $a;                     # 报错“can't read "a": no such variable”
```

### 3.2 替换

&#160; &#160; &#160; &#160; “$”可以实现替换，例如3.1节中提到的。Tcl对替换只进行一次解释，对嵌套的“$”不予理睬。

```tcl
set a x;                      # 定义变量a为x
set b a;                      # 定义变量b为a
puts $$b;                     # 等效为 puts {$a}
```

&#160; &#160; &#160; &#160; 方括号“[]”完成命令替换，将命令括起来，命令执行完后，返回结果。

```tcl
set b [set a 5];              # 将set a 5的结果赋值给b，即set b 5
set c [expr 5*10];            # 将乘式结果赋给c
```

&#160; &#160; &#160; &#160; 双引号和花括号黄多个单词组成一个参数，也是一种替换操作。双引号可以正常替换，花括号会组织内部的嵌套替换，如puts {$a}；如果花括号用作界定符，如过程定义时用作界限过程体时，不阻止替换操作，其他还有if条件语句、循环语句、switch语句和过程声明、数学表达式等。

```tcl
set s hello
puts "the length of \"$s\" is [string length $s]";  # 打印：the length of "hello" is 5
puts {the length of $s is [string length $s]};      # 打印：the length of $s is [string length $s]

set x 10;
set y 20;
set z [expr {$x+$y}];         # 用花括号来组织算术表达式，不阻止$替换操作
if {$x==10} {puts "x=$x"};    # 在条件语句中，花括号用来界定条件体喝执行体，不阻止内部替换
```


&#160; &#160; &#160; &#160; 反斜杠用来引用特殊字符，跟其他语言里类似。

----

## 4 数学表达式

### 4.1 数学和逻辑运算符

| 运算符 | 说明 |
| --- | --- |
| \- \+ \~ \! | 一元减（取负）、一元加、比特反、逻辑非 |
| \* \/ \% | 乘、除、取余 |
| + - | 加、减 |
| << >> | 左移、右移 |
| < <= > >= | 布尔小于、小于或等于、大于、大于或等于 |
| == != | 布尔等、不等 |
| & | 比特与 |
| ^ | 比特异或 |
| \| | 比特或 |
| && | 逻辑与 |
| \|\|| 逻辑或 |
| x?y:z | 三目运算符，跟verilog里一样 |

### 4.2 数学函数

| 函数名 | 说明 | 举例 |
| --- | --- | --- |
| abs() | 绝对值 |  |
| acos() | 反余弦 |  |
| asin() | 反正弦 |  |
| atan() | 反正切 |  |
| atan2 | 比值取反正切 |  |
| ceil() | 返回不小于输入值的整数值 |  |
| cos() | 余弦 |  |
| cosh() | 双曲余弦 |  |
| double() | 转换双精度 |  |
| exp() | e的幂 |  |
| floor() |  |  |
| fmod | 取余（结果为浮点型） |  |
| hypot(x,y) | 根据直角三角形两直角边长度计算出斜边长度 |  |
| int() | 取整 |  |
| log() | 自然对数 |  |
| log10() | 以十为底的对数 |  |
| pow | 幂运算 |  |
| rand() | 取0到1之间的随机实数 |  |
| round() | 四舍五入取整 |  |
| sin() |  |  |
| sinh |  |  |
| sqrt() | 求二次根 |  |
| srand() | 以输入的整数为随机数生成器的种子产生随机数 |  |
| tan() |  |  |
| tanh() |  |  |



----
&#160; &#160; &#160; &#160; 告辞。

