---
layout: post
title:  "VCS入门"
date:   2020-4-10 12:38:10 +0700
tags:
  - Digital IC Design
  - Synthesis
  - Tcl
---

-------

## 1 前言 

&#160; &#160; &#160; &#160; 同样只找到Verilog Compiled Simulator 2016，凑合用吧。


* 开发环境：
	* Verilog Compiled Simulator 2016
* 操作系统：
	* Ubuntu 18.04 LTS

----

## 2 综合概述

&#160; &#160; &#160; &#160; VCS工作流程如下图：

![2](https://raw.githubusercontent.com/Verdvana/Verdvana.github.io/master/_posts/VCS%E5%85%A5%E9%97%A8/2.jpg)

&#160; &#160; &#160; &#160; VCS编译RTL CODE过程如下图：

![1](https://raw.githubusercontent.com/Verdvana/Verdvana.github.io/master/_posts/VCS%E5%85%A5%E9%97%A8/1.jpg)


&#160; &#160; &#160; &#160; VCS先将verilog/systemverilog文件转化为C文件，在linux下编译链接生成可执行文件，在linux下运行simv即可得到仿真结果。

&#160; &#160; &#160; &#160; VCS的debug有两种方式：
* UCLI debugger：命令行；
* DVE debugger：图形化界面。

&#160; &#160; &#160; &#160; 仿真时要考虑的因素：
* 仿真速度；
* 信号可见性；
* 信号易处理性；
* 可用性，

&#160; &#160; &#160; &#160; Debugging的系统任务有：
* Debug 可视化：
  * $display：打印信息，显示当前变量的值；
  * $strobe：打印信息，显示用非阻塞赋值的变量值；
  * $monitor：打印信息，监控和输出参数列表中的表达式或变量值；
  * $time：以64位integer类型返回当前仿真时间；
* 停止仿真：
  * stop：暂停仿真，类似断点；
  * finish：结束仿真；
* 仿真激励和参考：
  * readmemh：从硬盘文件读取十六进制ASCII数据；
  * readmemb：从硬盘文件读取二进制ASCII数据；






----

## 3 VCS执行

### 3.1 编译链接生成二进制可执行文件

&#160; &#160; &#160; &#160; 编译指令如下：

```tcl
vcs source_file [compile_time_options]
```

&#160; &#160; &#160; &#160; 其中：
* source_file：
  * DUT里所有的Verilog/SystemVerilog源文件；
  * 按空格分开的多个源文件；
  * 顶层文件包含的DUT里的testbench。
* compile_time_options：
  * 指示VCS如何编译源文件；
  * 对于优化可见性和执行性能至关重要。


&#160; &#160; &#160; &#160; compile_time_options编译时可选的选项：
* 基本选项：
  * -mupdate：只编译修改过的文件；
  * -R：编译后继续执行仿真；
  * -gui：打开dve图形界面；
  * -l <filename>：设置log文件名，写入编译信息；
  * -sverilog：支持sv；
  * +v2k：支持Verilog2001标准；
  * debug：编译后调试；
  * debug_all：调试，并打开所有开关；
  * debug_pp：调试，平衡开关数量与调试速度；
* 工艺库选项：
  * -v <lib_file>：指定工艺库；
  * -y <lib_dir>：指定工艺库路径；
  * +libext+<lib_ext>：指定多个库文件；
  * +incdir+<inc_dir>：代码里如果有include，使用这个命令告诉vcs包含文件的位置。
* 文件选项：
  * -f file：当有很多源代码时，将这些源代码整合到file里；
* 修改可执行文件名字：
  * -o foo：使用此命令修改可执行文件simv的文件名；
* define 一个宏：
  * +define +<macro_name>=<value>：macro_name宏名、value初始化值。


### 3.2 仿真

&#160; &#160; &#160; &#160; 执行指令如下：

```tcl
simv [compile_time_options]
```
&#160; &#160; &#160; &#160; compile_time_options编译时可选的选项：
* -s：结束仿真时间；
* $plusargs()：从键盘或脚本中动态接收参数；
* -E echo：显示使用的选项；
* -l <logfile>：把仿真信息写入logfile文件里。

### 3.3 调用DW库

&#160; &#160; &#160; &#160; 使用如下指令指定DW库路径：

```tcl
-y $SYNOPSYS /dw/sim_ver+libext+.v+
```

&#160; &#160; &#160; &#160; 使用如下代码直接在代码中例化：

```verilog
Dwpart #(parameter) u1(
  .porta(a),
  .portb(b)
);
```








----
&#160; &#160; &#160; &#160; 告辞