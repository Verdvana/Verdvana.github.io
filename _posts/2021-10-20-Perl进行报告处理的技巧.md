---
layout: post
title:  "Perl进行报告处理的技巧"
date:   2021-10-20 21:10:20 +0700
tags:
  - Perl
---


----

## 1 前言

&#160; &#160; &#160; &#160; 


## 1 检查报告与过滤waive文件

&#160; &#160; &#160; &#160; 在检查EDA软件吐出来的报告时，


```perl
#! /usr/bin/perl -w

##################################################################################
#获取起始时间
my $time_start = time();


##################################################################################
#检查文件
my $chk_rpt     = "./report.rpt";
my @waive_file  = <./waiver/*>;
my $result      = "./check_line.rpt";
my $match;

open RPT, "< $chk_rpt" or die "Can not open $chk_rpt !\n";
open OUT, "> $result";

while(my $line = <RPT>){
    foreach my $file(@waive_file){
        open WAIVE, "< $file" or die "Can not open $file !\n";
        
        while(my $waiver = <WAIVE>){
            if($line =~ /\Q$waiver\E/){
                $match = 1;
                last;
            }
        }
        close WAIVE;
        if($match){
            last;
        }
    }


    print OUT $line if(!$match);
    $match = 0;
}

close RPT;
close OUT;

##################################################################################
#获取停止时间
my $time_stop = time();

##################################################################################
#计算时间差
my $time_delta = $time_stop-$time_start;
my $hour_delta = int($time_delta/3600);
my $min_delta  = int(($time_delta-$hour_delta*3600)/60);
my $sec_delta  = $time_delta-$hour_delta*3600-$min_delta*60;

open TIMECOST, "> ./time_cost_line";
print TIMECOST "用时：$hour_delta:$min_delta:$sec_delta\n";
print "用时：$hour_delta:$min_delta:$sec_delta\n";
close TIMECOST;
```

```perl
#! /usr/bin/perl -w

##################################################################################
#获取起始时间
my $time_start = time();

##################################################################################
#检查文件
use List::Compare;

my $chk_rpt     = "./report.rpt";
my @waive_file  = <./waiver/*>;
my $result      = "./check_list.rpt";

my @rpt;
my @waiver;

my $match;

open RPT, "< $chk_rpt" or die "Can not open $chk_rpt !\n";
open OUT, "> $result";

#将报告push到数组
while(my $line = <RPT>){
    push @rpt, $line;
}
close RPT;

#将waiver文件push到数组
foreach my $file(@waive_file){
    open WAIVE, $file;
    while(<WAIVE>){
        push @waiver, $_;
    }
    close WAIVE;
}

#使用List::Comparemodule对比数组
my $lc      = List::Compare->new('-u',\@rpt,\@waiver);
my @unique  = $lc->get_unique;

print OUT @unique;
close OUT;


##################################################################################
#获取停止时间
my $time_stop = time();

##################################################################################
#计算时间差
my $time_delta = $time_stop-$time_start;
my $hour_delta = int($time_delta/3600);
my $min_delta  = int(($time_delta-$hour_delta*3600)/60);
my $sec_delta  = $time_delta-$hour_delta*3600-$min_delta*60;

open TIMECOST, "> ./time_cost_list";
print TIMECOST "用时：$hour_delta:$min_delta:$sec_delta\n";
print "用时：$hour_delta:$min_delta:$sec_delta\n";
close TIMECOST;
```


----
&#160; &#160; &#160; &#160; 告辞。