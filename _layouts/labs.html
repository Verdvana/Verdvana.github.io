
---
layout: default
---

<style>
  .labs-intro{opacity:.85;margin:8px 0 14px;line-height:1.7}
  .labs-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px;margin:18px 0}

  /* Card as <a> so whole card is clickable */
  .labs-card{
    display:block;
    color:inherit;
    text-decoration:none;
    border:1px solid rgba(0,0,0,.10);
    border-radius:12px;
    overflow:hidden;
    background:rgba(255,255,255,.86);
    transition:transform .12s ease, box-shadow .12s ease, border-color .12s ease;
  }
  .labs-card:hover{
    transform:translateY(-1px);
    box-shadow:0 10px 28px rgba(0,0,0,.12);
    border-color:rgba(0,0,0,.18);
  }

  .labs-thumb{
    width:100%;
    aspect-ratio:16/9;
    object-fit:cover;
    background:#f3f4f6;
    display:block;
  }
  .labs-thumb--empty{
    display:flex;
    align-items:center;
    justify-content:center;
    color:rgba(0,0,0,.45);
    font-size:12px;
  }

  .labs-body{padding:12px 14px}
  .labs-title{font-size:16px;margin:0 0 6px 0;line-height:1.35}
  .labs-desc{font-size:13px;opacity:.85;margin:0 0 8px 0;line-height:1.6}
  .labs-tags{display:flex;flex-wrap:wrap;gap:6px}
  .labs-tag{font-size:12px;padding:2px 8px;border-radius:999px;background:rgba(0,0,0,.06)}
  .labs-meta{font-size:12px;opacity:.6;margin-top:8px;word-break:break-all}

  .labs-warn{padding:10px 12px;border:1px dashed rgba(0,0,0,.25);border-radius:10px;background:rgba(255,255,255,.65)}
</style>

<h1>{{ page.title }}</h1>

{% if content and content != "" %}
  <div class="labs-intro">{{ content }}</div>
{% endif %}

{%- comment -%}
  方案A：实验页放 /labs/*.html 且不写 front matter(---)，会作为静态文件出现在 site.static_files，且具有 path/basename/extname 等字段。[2](https://www.jekyll.com.cn/docs/includes/)
  兼容：若实验页写了 front matter，会从 static_files 变成 pages，因此同时扫描 site.pages。[2](https://www.jekyll.com.cn/docs/includes/)
  链接/资源：使用 relative_url 自动拼接 baseurl，避免部署在子路径时链接失效。[1](https://jekyllrb.com/docs/permalinks/)[3](http://jekyllcn.com/docs/collections/)
{%- endcomment -%}

{% assign lab_static = site.static_files
  | where_exp: "f", "f.extname == '.html'"
  | where_exp: "f", "(f.path | slice: 0, 6) == '/labs/'"
%}

{% assign lab_pages = site.pages
  | where_exp: "p", "p.url != nil"
  | where_exp: "p", "(p.url | slice: 0, 6) == '/labs/'"
  | where_exp: "p", "p.url endswith '.html'"
%}

{% assign lab_files = lab_static | concat: lab_pages %}

{% if lab_files.size == 0 %}
  <div class="labs-warn">
    还没有发现 <code>/labs/</code> 目录下的 HTML 文件。请把实验页面放到仓库的 <code>labs/</code> 目录中。
    <br/>
    <small>提示：实验页如果写了 <code>---</code> front matter，会从静态文件变成 page；本布局已兼容，但更推荐不写 <code>---</code>。</small>
  </div>
{% else %}

  {% assign metas = site.data.labs | sort: "order" %}

  <div class="labs-grid">
    {%- comment -%} 先按 _data/labs.yml 输出（有标题/描述/缩略图/排序） {%- endcomment -%}
    {%- for meta in metas -%}
      {%- assign found = nil -%}

      {%- comment -%}
        在 lab_files 里找 basename==slug（static_files 有 basename；page 也通常有 basename/name）
      {%- endcomment -%}
      {%- for x in lab_files -%}
        {%- assign xslug = x.basename | default: x.name | remove: '.html' -%}
        {%- if xslug == meta.slug -%}
          {%- assign found = x -%}
        {%- endif -%}
      {%- endfor -%}

      {%- if found -%}
        {%- assign href = found.path | default: found.url -%}

        <a class="labs-card"
           href="{{ href | relative_url }}"
           {% if page.new_tab %}target="_blank" rel="noopener"{% endif %}>
                 alt="{{ meta.title | escape }}">
                       <div class="labs-body">
            <h3 class="labs-title">{{ meta.title | default: meta.slug }}</h3>

            {% if meta.desc %}
              <p class="labs-desc">{{ meta.desc }}</p>
            {% endif %}

            {% if meta.tags %}
              <div class="labs-tags">
                {% for t in meta.tags %}
                  <span class="labs-tag">{{ t }}</span>
                {% endfor %}
              </div>
            {% endif %}

            <div class="labs-meta">{{ href }}</div>
          </div>
        </a>
      {%- endif -%}
    {%- endfor -%}

    {%- comment -%}
      兜底：把没有写进 _data/labs.yml 的实验页也显示出来
    {%- endcomment -%}
    {% for f in lab_files %}
      {% assign slug = f.basename | default: f.name | remove: '.html' %}
      {% assign m = site.data.labs | where: "slug", slug | first %}
      {% if m == nil %}
        {% assign href = f.path | default: f.url %}

        <a class="labs-card"
           href="{{ href | relative_url }}"
           {% if page.new_tab %}target="_blank" rel="noopener"{%          <h3 class="labs-title">{{ slug }}</h3>
            <p class="labs-desc">（未在 <code>_data/labs.yml</code> 中配置预览信息）</p>
            <div class="labs-meta">{{ href }}</div>
          </div>
        </a>
      {% endif %}
    {% endfor %}
  </div>

{% endif %}
